<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0088d1',
                        title: '#3366cc',
                        company: '#FF0000',
                        success: '#4CAF50',
                        danger: '#f44336',
                        warning: '#FF9800',
                        normal: '#333333',
                        abnormal: '#FF5722'
                    }
                }
            }
        }
    </script>
    <style>
        .video-container {
            aspect-ratio: 16/9;
            background-color: #000;
        }
        .status-box {
            height: 36px;
            line-height: 30px;
        }
        .video-frame {
            border: 1px solid #0088d1;
        }
        /* Hiệu ứng loading */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .pulse-loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-2 max-w-screen-xl">
        <!-- Header -->
        <header class="flex items-start justify-between mb-4">
            <!-- Left Logo -->
            <div class="flex-shrink-0 ml-2">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="h-40 w-40 object-contain">
            </div>
            
            <!-- Center Titles -->
            <div class="flex flex-col items-center justify-center mt-4">
                <h1 class="text-2xl md:text-3xl font-bold text-center text-company mb-1">BAN QUẢN LÝ KHU CÔNG NGHỆ CAO THÀNH PHỐ HỒ CHÍ MINH</h1>
                <h2 class="text-xl md:text-2xl font-bold text-center text-company mb-3">TRUNG TÂM NGHIÊN CỨU TRIỂN KHAI KHU CÔNG NGHỆ CAO</h2>
                <h3 class="text-xl md:text-2xl font-bold text-center text-title">HỆ THỐNG GIÁM SÁT QUÁ TRÌNH TẬP LUYỆN</h3>
                <p class="text-lg font-bold text-normal mt-3">{{ message }}</p>
            </div>
            
            <!-- Right Logo -->
            <div class="flex-shrink-0 mr-2">
                <img src="{{ url_for('static', filename='images/logo2.png') }}" alt="Logo 2" class="h-24 w-80 object-contain">
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="flex flex-col items-center justify-center">
            <!-- Video Container -->
            <div class="w-3/5 video-frame bg-gray-100 p-1">
                <div class="video-container overflow-hidden">
                    <img src="{{ url_for('login_feed') }}" alt="Video Feed" class="w-full h-full object-cover">
                </div>
            </div>
            
            <!-- Message Frame -->
            <div class="w-1/2 mt-5 border border-gray-300 bg-white p-2">
                <div id="login-message" class="text-center text-lg font-semibold text-normal">
                    Đang nhận diện khuôn mặt...
                </div>
            </div>
        </main>
        
        <!-- Action Buttons -->
        <div class="flex justify-center mt-8">
            <button id="btn-exit" class="bg-danger text-white py-2 px-4 border border-danger font-bold">
                Thoát
            </button>
        </div>
        
        <!-- Footer -->
        <footer class="mt-8 py-3 text-center text-gray-600 border-t border-gray-200">
            <p>© 2023 Hệ Thống Giám Sát Quá Trình Tập Luyện. All rights reserved.</p>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginMessage = document.getElementById('login-message');
            const exitButton = document.getElementById('btn-exit');
            let checkInterval;
            
            // Check login status every 2 seconds
            function startLoginCheck() {
                checkInterval = setInterval(checkLoginStatus, 2000);
            }
            
            function checkLoginStatus() {
                fetch('/api/check_login_status')
                    .then(response => response.json())
                    .then(data => {
                        // Update message
                        loginMessage.textContent = data.message;
                        
                        // If authenticated or needs data collection, redirect
                        if (data.authenticated || data.redirect) {
                            clearInterval(checkInterval);
                            loginMessage.textContent = data.message;
                            loginMessage.style.color = '#4CAF50';
                            
                            // Add delay before redirect
                            setTimeout(() => {
                                window.location.href = data.redirect;
                            }, 2000);
                        }
                    })
                    .catch(error => {
                        console.error('Error checking login status:', error);
                        loginMessage.textContent = 'Lỗi kết nối đến máy chủ';
                        loginMessage.style.color = '#f44336';
                    });
            }
            
            // Exit button
            exitButton.addEventListener('click', function() {
                window.close();
                // Alternative for web:
                if (confirm('Bạn có chắc muốn thoát ứng dụng?')) {
                    fetch('/api/shutdown', {
                        method: 'POST',
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Show exit message
                        document.body.innerHTML = `
                            <div class="fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-800 bg-opacity-75 z-50">
                                <div class="text-center p-10 bg-white rounded-lg shadow-lg">
                                    <div class="mx-auto mb-4">✓</div>
                                    <h2 class="text-xl font-bold mb-2">Ứng dụng đã tắt</h2>
                                    <p class="text-gray-600">Bạn có thể đóng cửa sổ này</p>
                                </div>
                            </div>`;
                    });
                }
            });
            
            // Start checking login status
            startLoginCheck();
        });
    </script>
</body>
</html> 